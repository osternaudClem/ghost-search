function isDOMElement(t){return t&&"undefined"!=typeof window&&(t===window||t.nodeType)}function extend(t){if(arguments.length<=0)throw new Error("Missing arguments in extend function");var e,s,n=t||{};for(s=1;s<arguments.length;s++){var a=arguments[s]||{};for(e in a)"object"!=typeof n[e]||isDOMElement(n[e])?n[e]=n[e]||a[e]:n[e]=extend(n[e],a[e])}return n}function getElement(t){var e=null,s=t[0];switch(s){case"#":var n=t.substring(1);if(e=document.getElementById(n),!e)throw new Error('The ID "'+n+'" does not exist on this page');break;case".":var n=t.substring(1);if(e=document.getElementById(n),!e)throw new Error('The Class "'+n+'" does not exist on this page');break;default:if(e=t,!e)throw new Error('The DOM Element "'+t+'" does not exist on this page')}return e}function GhostSearch(t){t=extend(t,GhostSearch.options),this.input=getElement(t.input),this.container=getElement(t.container),this.atStart=t.atStart,this.classes=t.classes,this.posts=[],this.postsDom=[],this.url=t.api,this.init()}GhostSearch.prototype.init=function(){var t=this;this.input.addEventListener("input",function(e){t._search(e)},!1),this._createHtml()},GhostSearch.prototype._search=function(t){var e=this,s=t.target.value;s=s.split(" ");for(var n=0;n<e.posts.length;n++){e.postsDom[n].style.display="none";for(var a=0,r=0;r<s.length;r++)(e.posts[n].title.toLowerCase().indexOf(s[r].toLowerCase())>-1||e.posts[n].html.toLowerCase().indexOf(s[r].toLowerCase())>-1)&&a++;a==s.length&&(e.postsDom[n].style.display="block")}},GhostSearch.prototype._createHtml=function(){var t=this,e=this.container;this._loadXml(this.url).then(function(s){t.posts=s.posts;for(var n=0;n<t.posts.length;n++){var a=t.posts[n],r=document.createElement("div");r.setAttribute("class",t.classes.item);var o=document.createElement("header");o.setAttribute("class",t.classes.header),r.appendChild(o);var i=document.createElement("h2");i.setAttribute("class",t.classes.title),o.appendChild(i);var l=document.createElement("a");l.setAttribute("href",location.origin+"/"+a.slug),l.innerHTML=a.title,i.appendChild(l);var c=document.createElement("section");c.setAttribute("class",t.classes.meta),o.appendChild(c);var h=document.createElement("time");h.setAttribute("class",t.classes.date),h.innerHTML=t._setDate(a.published_at),c.appendChild(h);var p=document.createElement("div");p.setAttribute("class","post-tags-list"),t._insertTags(a.tags,p),c.appendChild(p);var u=document.createElement("section");u.setAttribute("class",t.classes.desc),r.appendChild(u);document.createElement("p");a.html.length>150&&(a.html=a.html.substring(0,150)+"..."),u.innerHTML=a.html,"hide"==t.atStart&&(r.style.display="none"),t.postsDom.push(r),e.appendChild(r)}})},GhostSearch.prototype._loadXml=function(t){new XMLHttpRequest;return promise=new Promise(function(e,s){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(4==n.readyState&&200==n.status){var t=JSON.parse(n.responseText);e(t)}},n.open("GET",t,!0),n.send()}),promise},GhostSearch.prototype._setDate=function(t){var e=new Date(t),s=Array("January,","February,","March,","April,","May,","June,","July,","August,","September,","October,","November,","December,");return e.getDate()+" "+s[e.getMonth()]+" "+e.getFullYear()},GhostSearch.prototype._insertTags=function(t,e){for(var s=0;s<t.length;s++){var n=t[s],a=document.createElement("a");if(a.setAttribute("href",location.origin+"/tag/"+n.slug),a.setAttribute("class",this.classes.tag),a.innerHTML=n.name,e.appendChild(a),s<t.length-1){var r=document.createElement("span");r.innerHTML=", ",e.appendChild(r)}}},GhostSearch.options={input:null,container:null,api:null,atStart:"show",classes:{item:"post-item",header:"post-header",title:"post-title",meta:"post-meta",date:"post-date",tags:"post-tags-list",tag:"post-tag",desc:"post-excerpt"}};
